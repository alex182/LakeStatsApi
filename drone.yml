kind: pipeline
type: docker
name: Lake_Stats_API

steps:
- name: greeting
  image: alpine
  commands:
  - echo hello world API
#- name: docker build
#  image: plugins/docker
#  command:
#  environment:
#    INFLUX_KEY:
#      from_secret: INFLUX_KEY
#  settings:
#    repo: 192.168.1.136:9005/lake_stats_api
#    registry: 192.168.1.136:9005
#    tags: latest
#    insecure: true 
#    build_args_from_env:
#    - INFLUX_KEY
- name: deploy
  image: appleboy/drone-ssh
  environment:
    PLUGIN_ENVS: DRONE-SERVICE-USER-PASSWORD
    DRONE-SERVICE-USER-PASSWORD:
      from_secret: drone-service-user-password
  settings:
    host:
      - 192.168.1.136
    username: drone-service-user
    password:
      from_secret: drone-service-user-password
    port: 22
    command_timeout: 2m
    envs: [DRONE-SERVICE-USER-PASSWORD]
    script:
    - echo $${DRONE-SERVICE-USER-PASSWORD}
    - echo "$DRONE-SERVICE-USER-PASSWORD"
    - sudo ls /var/lib/docker/volumes/portainer_data/_data/compose/