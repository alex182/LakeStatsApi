kind: pipeline
type: docker
name: Lake_Stats_API

steps:
- name: greeting
  image: alpine
  commands:
  - echo hello world API
#- name: docker build
#  image: plugins/docker
#  command:
#  environment:
#    INFLUX_KEY:
#      from_secret: INFLUX_KEY
#  settings:
#    repo: 192.168.1.136:9005/lake_stats_api
#    registry: 192.168.1.136:9005
#    tags: latest
#    insecure: true 
#    build_args_from_env:
#    - INFLUX_KEY
- name: deploy
  image: appleboy/drone-ssh
  settings:
    host:
      - 192.168.1.136
    username: drone-service-user
    password:
      from_secret: drone-service-user-password
    environment:
      portainer_ssh_password:
        from_secret: drone-service-user-password
    port: 22
    command_timeout: 2m
    script:
    - echo ${drone-service-user-password} ---------
    - sudo ls /var/lib/docker/volumes/portainer_data/_data/compose/